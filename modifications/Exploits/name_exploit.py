from mitmproxy import http
from type_definitions import defaultUserSettings
from utils import checks
from utils import config



class name:
    def __init__(self, userSettings: defaultUserSettings):
        self.chosenDisplayName = config.read()["extraSettings"]["display_name"]
        self.userSettings: defaultUserSettings = userSettings

    @checks.is_fortnite_request
    def request(self, flow: http.HTTPFlow):

        displayName = self.userSettings["displayName"]

        if self.chosenDisplayName == "" or displayName == "":
            return

        # flow.request.headers["X-Fortnite-VSided-DisplayName"] = self.chosenDisplayName
        if flow.request.text:
            flow.request.text = flow.request.text.replace(
                displayName, self.chosenDisplayName
            )

    @checks.is_fortnite_request
    def response(self, flow: http.HTTPFlow):

        displayName = self.userSettings["displayName"]

        if self.chosenDisplayName == "" or displayName == "":
            return

        if flow.response is None:
            return

        if flow.response.text is None:
            return

        flow.response.text = flow.response.text.replace(
            displayName, self.chosenDisplayName
        )
