from mitmproxy import http

from type_definitions import defaultUserSettings
from utils import checks
from utils import config
from utils import console_logs as logger

class playlist:
    def __init__(self, userSettings: defaultUserSettings):
        self.userSettings: defaultUserSettings = userSettings

    @checks.is_fortnite_request
    def request(self, flow: http.HTTPFlow):
        if not self.userSettings["premium"]: return
        
        if flow.request.url != "https://fngw-mcp-gc-livefn.ol.epicgames.com/fortnite/api/game/v2/matchmakingservice/ticket/player": return
        
        flow.request.url = flow.request.url.replace(
            "playlist_nobuildbr_squad",
            config.read()["extraSettings"]["playlist"],
        )
        logger.info(f"Matchmaking: {flow.request.url}")